var myApp=angular.module("myApp",["ui.bootstrap","flow"]);myApp.config(["$httpProvider",function(e){e.interceptors.push("httpInterceptor"),e.defaults.headers.common={},e.defaults.headers.post={},e.defaults.headers.put={},e.defaults.headers.patch={},e.defaults.useXDomain=!0,delete e.defaults.headers.common["X-Requested-With"]}]),myApp.factory("httpInterceptor",function(e,t){var a=0;return{request:function(o){return a++,t.$broadcast("loader_show"),o||e.when(o)},response:function(o){return 0===--a&&t.$broadcast("loader_hide"),o||e.when(o)},responseError:function(o){return--a||t.$broadcast("loader_hide"),e.reject(o)}}}),myApp.config(["flowFactoryProvider",function(e){e.defaults={target:"upload.php",permanentErrors:[404,500,501],maxChunkRetries:1,chunkRetryInterval:5e3,simultaneousUploads:4,singleFile:!0},e.on("catchAll",function(){})}]),myApp.directive("loader",function(){return function(e,t){return e.$on("loader_show",function(){return t.show()}),e.$on("loader_hide",function(){return t.hide()})}}),myApp.controller("MainCtrl",["$scope","$http","$dialog","$location",function(e,t,a){e.id="",t.get("http://localhost:4567/getEmployees").success(function(t){e.employeeDetails=t});var o='<div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" ng-click="close()" aria-hidden="true">&times;</button><h4 class="modal-title">View Employee Details</h4></div><div class="modal-body"><div style="margin: 0 auto; width: 100px"> <img class="thumbnailImg" style="width:100px;height:100px;margin:10px;" src="{{viewEmployeeDetails.empImage}}"   /></div><div class="table"><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><th>Employee ID</th><td>{{viewEmployeeDetails.empNo}}</td><th>Employee Name</th><td><h3>{{viewEmployeeDetails.firstName}}  {{viewEmployeeDetails.lastName}}</h3></td><th>Email ID</th><td>{{viewEmployeeDetails.emailId}}</td><th>Alternate Email ID</th><td>{{viewEmployeeDetails.alternateEmailId}}</td><th>Status</th><td>{{viewEmployeeDetails.employeeStatus}}</td></tr><tr><th>PAN No.</th><td>{{viewEmployeeDetails.panNo}}</td><th>PF No.</th><td>{{viewEmployeeDetails.pfNumber}}</td><th>Bank Name</th><td>{{viewEmployeeDetails.bankName}}</td><th>Bank Details</th><td>{{viewEmployeeDetails.bankAccountNo}}</td><th>Joining Date</th><td>{{viewEmployeeDetails.joiningDate}}</td></tr><tr><th>Designation</th><td>{{viewEmployeeDetails.designation}}</td><th>Location</th><td>{{viewEmployeeDetails.location}}</td><th>Date Of Birth</th><td>{{viewEmployeeDetails.dateOfBirth}}</td><th>Marriage Date</th><td>{{viewEmployeeDetails.marriageDate}}</td><th>Contact No.</th><td>{{viewEmployeeDetails.contactNumber}}</td></tr><tr><th>Alternate Contact No.</th><td>{{viewEmployeeDetails.alternateContactNumber}}</td><th>Emergengy Contact Person </th><td>{{viewEmployeeDetails.emergencyContactPerson}}</td></tr></table></div></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="close()">Close</button></div></div><!-- /.modal-content --></div><!-- /.modal-dialog -->';e.opts={backdrop:!0,keyboard:!0,backdropClick:!0,template:o,controller:"ViewDialogController",resolve:{idParam:function(){return e.id}}},e.openDialog=function(t){e.id=t;var o=a.dialog(e.opts);o.open().then(function(e){e&&alert("dialog closed with result: "+e)})}}]),myApp.controller("ViewDialogController",["$scope","$http","dialog","idParam",function(e,t,a,o){e.viewEmployeeDetails={},t.get("http://localhost:4567/getEmployees").success(function(t){e.employeeDetails=t,e.viewEmployeeDetails=_.findWhere(e.employeeDetails,{empNo:o}),e.viewEmployeeDetails.empImage||(e.viewEmployeeDetails.empImage="imgs/empty.png"),e.viewEmployeeDetails.employeeStatus=1==e.viewEmployeeDetails.employeeStatus?"Active":"Inactive"}),e.close=function(e){a.close(e)}}]),myApp.controller("UpdateOldEmployee",["$rootScope","$scope","$window","$location","$http",function(e,t,a,o,l){t.newEmployee={};var i=a.empid;t.dateField={},t.updateEmployee=function(){a.imageName&&(t.newEmployee.empImage=a.imageName),moment(t.newEmployee.dateOfBirth,"DD-MM-YYYY").isValid()||(t.dateField.dateOfBirth=moment(t.newEmployee.dateOfBirth).format("DD-MM-YYYY"),t.newEmployee.dateOfBirth=t.dateField.dateOfBirth),moment(t.newEmployee.joiningDate,"DD-MM-YYYY").isValid()||(t.dateField.joiningDate=moment(t.newEmployee.joiningDate).format("DD-MM-YYYY"),t.newEmployee.joiningDate=t.dateField.joiningDate),t.newEmployee.marriageDate?moment(t.newEmployee.marriageDate,"DD-MM-YYYY").isValid()||(t.dateField.dateOfMarriage=moment(t.newEmployee.marriageDate).format("DD-MM-YYYY"),t.newEmployee.marriageDate=t.dateField.dateOfMarriage):t.newEmployee.marriageDate="",l.post("http://localhost:4567/updateEmployee",t.newEmployee).success(function(e){alert("1 rows updated"==e?"Record Updated ":"Record Not Updated"),a.location.href="employeeDetails.html"})};var i=parseInt(i);l.get("http://localhost:4567/getEmployeeById/"+i).success(function(e){t.newEmployee=e,t.newEmployee.employeeStatus=1==t.newEmployee.employeeStatus?!0:!1})}]),myApp.controller("AddNewEmployee",["$rootScope","$scope","$http","$routeParams","$route","$location","$window",function(e,t,a,o,l,i,n){t.newEmployee={},t.newDateField={},t.newEmployee.employeeStatus=!0,t.addNewEmployee=function(){t.newEmployee.empImage=n.imageName,moment(t.newEmployee.dateOfBirth,"DD-MM-YYYY").isValid()||(t.newDateField.dateOfBirth=moment(t.newEmployee.dateOfBirth).format("DD-MM-YYYY"),t.newEmployee.dateOfBirth=t.newDateField.dateOfBirth),moment(t.newEmployee.joiningDate,"DD-MM-YYYY").isValid()||(t.newDateField.joiningDate=moment(t.newEmployee.joiningDate).format("DD-MM-YYYY"),t.newEmployee.joiningDate=t.newDateField.joiningDate),t.newEmployee.marriageDate?moment(t.newEmployee.marriageDate,"DD-MM-YYYY").isValid()||(t.newDateField.dateOfMarriage=moment(t.newEmployee.marriageDate).format("DD-MM-YYYY"),t.newEmployee.marriageDate=t.newDateField.dateOfMarriage):t.newEmployee.marriageDate="",t.newEmployee.empImage||(t.newEmployee.empImage="imgs/empty.png"),a.post("http://localhost:4567/addEmployee",t.newEmployee).success(function(e){alert("1 rows affected"==e?"Record Added ":"Record Not Added"),n.location.reload()})}}]),myApp.controller("FormCtrl",["$rootScope","$scope","$http",function(e,t,a){t.showtable=!1,t.days=[];var o,l=!1,n=!0;for(t.monthList=[],t.yearList=[],t.lopDays=[],t.employeeData=[],t.$watch("employeeData.basic * 12 / 100",function(e){e?(t.employeeData.pfEmployee=e,t.employeeData.totalDeductions=e+200):t.employeeData.pfEmployee=""}),i=0;31>=i;i++)t.days.push({key:i,label:i});a.get("http://localhost:4567/getEmployeesByStatus").success(function(e){t.employeeDetails=e,t.monthList=t.getMonthList(),t.yearList=t.getYearList(),n&&a.get("http://localhost:4567/getCurrentYearMonthWithNoOfDays").success(function(e){n=!1,t.employeeData.month=e.month,t.employeeData.year=e.year,t.employeeData.totalNoOfDays=e.noOfDays})}),t.changeMonthList=function(){t.employeeData.totalNoOfDays=0,t.employeeData.month="",t.monthList=t.getMonthList()},t.updateTotalNoOfDays=function(e,o){a.get("http://localhost:4567/getNoOfDaysForGivenYearAndMonth/getDate?year="+e+"&month="+o).success(function(e){t.employeeData.month=e.month,t.employeeData.year=e.year,t.employeeData.totalNoOfDays=e.noOfDays})},t.getMonthList=function(){for(months=[],startOfMonth=moment().month(0).startOf("month"),months.push({key:0,label:startOfMonth.format("MMMM")}),i=1;12>i;i++)months.push({key:i,label:startOfMonth.add("months",1).format("MMMM")});return months},t.getYearList=function(){for(years=[],startYear=moment().startOf("year"),i=1;3>=i;i++)years.push({key:i,label:startYear.format("YYYY")}),startYear=startYear.subtract("years",1);return years},t.getEmployeeId=function(e){t.employeeData&&(o=t.employeeData,l=!0),t.employeeData=_.findWhere(t.employeeDetails,{empNo:e}),t.employeeData.medical="1250",t.employeeData.conveyence="800",t.employeeData.esi="0",t.employeeData.professionalTax="200",t.employeeData.basic="0",t.employeeData.hra="0",t.employeeData.exgratia="0",t.employeeData.lta="0",t.employeeData.performanceBonus="0",t.employeeData.otherAllowance="0",t.employeeData.tds="0",t.employeeData.otherDeductions="0",l&&(t.employeeData.month=o.month,t.employeeData.year=o.year,t.employeeData.totalNoOfDays=o.totalNoOfDays,t.employeeData.comments=o.comments),t.showtable=!0},t.sendMail=function(){t.employeeData=_.findWhere(t.employeeDetails,{empNo:t.employeeDetails.selectedEmpId}),a.post("http://localhost:4567/submit",t.employeeData).success(function(e){t.resetData(),alert("Email successfully sent"==e?"Email is sent to "+t.employeeData.firstName+" "+t.employeeData.lastName:"Mail cannot be sent")}),t.showtable=!1},t.resetData=function(){t.employeeData.totalDeductions="",t.employeeData.grossEarnings="",t.employeeData.totalPayable="",t.employeeDetails.selectedEmpId="",t.employeeData.medical="",t.employeeData.conveyence="",t.employeeData.esi="",t.employeeData.professionalTax="",t.employeeData.basic="",t.employeeData.hra="",t.employeeData.exgratia="",t.employeeData.lta="",t.employeeData.performanceBonus="",t.employeeData.otherAllowance="",t.employeeData.tds="",t.employeeData.otherDeductions=""},t.updateGrossEarning=function(e){t.employeeData.grossEarnings=e},t.updateTotalDeduction=function(e){t.employeeData.totalDeductions=e}}]),myApp.controller("LeaveManagement",["$rootScope","$scope","$http","$dialog","$location","$window",function(e,t,a,o,l,i){t.id="",t.boolMsg=!1,t.boolDisplay=!0,t.searchEmployee={empNo:"",firstName:"",lastName:"",fromDate:"",toDate:""},t.applyDateRange=function(e,a){t.searchEmployee.fromDate=moment(e.trim()).format("DD-MM-YYYY"),t.searchEmployee.toDate=moment(a.trim()).format("DD-MM-YYYY")},t.submitSearch=function(){t.boolDisplay=!1,a.get("http://localhost:4567/searchByCriteria/leaveManagement?id="+t.searchEmployee.empNo+"&firstName="+t.searchEmployee.firstName+"&lastName="+t.searchEmployee.lastName+"&fromDate="+t.searchEmployee.fromDate+"&toDate="+t.searchEmployee.toDate).success(function(e){"Please Select Atleast One Search Criteria"==e?(t.boolMsg=!1,alert("Please Select Atleast One Search Criteria"),a.get("http://localhost:4567/getEmployeeLeaveDetails").success(function(e){t.employeeDetails=e})):"No Records Found"!=e?(t.employeeDetails=e,t.searchEmployee.empNo="",t.searchEmployee.firstName="",t.searchEmployee.lastName="",t.searchEmployee.fromDate="",t.searchEmployee.toDate="",t.boolMsg=!1):(t.employeeDetails={},t.searchEmployee.empNo="",t.searchEmployee.firstName="",t.searchEmployee.lastName="",t.searchEmployee.fromDate="",t.searchEmployee.toDate="",t.boolMsg=!0)})},t.boolDisplay&&a.get("http://localhost:4567/getEmployeeLeaveDetails").success(function(e){t.employeeDetails=e});var n='<div class="modal-dialog"><div class="modal-content"><div style="margin:10px;"><button type="button" class="close" ng-click="close()" aria-hidden="true">&times;</button><h4 class="modal-title" style="font-weight:bold;">Leave Details</h4></div><div class="modal-body" ><div class="table"><div ><div class="row-form clearfix"><div class="span3" style="font-size:15px;margin:10px;">Employee ID</div><div class="span3" style="margin:10px;">{{employeeDetails.empNo}}</div></div><div class="row-form clearfix"><div class="span3" style="font-size:15px;margin:10px;">Employee Name</div><div class="span3" style="margin:10px;">{{employeeDetails.firstName}}  {{employeeDetails.lastName}}</div></div> <div class="row-form clearfix"><div class="span3" style="font-size:15px;margin:10px;">Email ID</div><div class="span3" style="margin:10px;">{{employeeDetails.emailId}}</div></div><div ng-show="boolDisplay" ><h2 style="display:block;left-margin:20px;color:red;">No Records Found</h2></div></div><table width="100%" border="0" cellspacing="0" cellpadding="0" ng-show="!boolDisplay"><tr><th>From Date</th><th>To date</th><th>Availed</th><th>Leave Type</th><th></th><th></th></tr><tr ng-repeat="leave in leaveEmployeeDetails" ><td>{{leave.fromDate}}</td><td>{{leave.toDate}}</td><td>{{leave.differenceBetweenFromDateToDate}}</td><td>{{leave.leaveType}}</td><td><a ng-click="editLeave({{leave.empNo}},{{leave.uniqueId}})" id="urlPathEmployee" style="cursor: pointer;text-decoration:none;"  class="btn btn-small" title="Edit">Edit</a></td><td><a ng-click="deleteLeave({{leave.empNo}},{{leave.uniqueId}})" style="cursor: pointer;text-decoration:none;"  class="btn btn-small" title="Delete">Delete</a></td></tr></table></div></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="close()">Close</button></div></div></div>';t.opts={backdrop:!0,keyboard:!0,backdropClick:!0,template:n,controller:"LeaveDialogController",resolve:{idParam:function(){return t.id}}},t.openDialog=function(e){t.id=e;var a=o.dialog(t.opts);a.open().then(function(e){e&&alert("dialog closed with result: "+e)})},t.registerLeaves=function(e){if(e.lop>0){var t=confirm(e.firstName+" "+e.lastName+" exceed the total leaves.");1==t&&(i.location.href="registerLeave.html?id="+e.empNo)}else i.location.href="registerLeave.html?id="+e.empNo}}]),myApp.controller("LeaveDialogController",["$scope","$http","dialog","idParam","$window",function(e,t,a,o,l){e.leaveEmployeeDetails={},e.boolDisplay=!1,e.deleteLeaveObj={},t.get("http://localhost:4567/getEmployeeByIdForApplyingNewLeave/"+o).success(function(t){e.employeeDetails=t}),t.get("http://localhost:4567/getEmployeeAppliedLeaveDetailsById/"+o).success(function(t){t?(e.boolDisplay=!1,e.leaveEmployeeDetails=t):(e.boolDisplay=!0,e.leaveEmployeeDetails={})}),e.close=function(e){a.close(e),l.location.reload()},e.editLeave=function(e,t){l.location.href="updateLeave.html?id="+e+"&Uid="+t},e.deleteLeave=function(a,o){e.deleteLeaveObj={empNo:a,uniqueId:o},t.post("http://localhost:4567/deleteEmployeeAppliedLeaveDetailsByLeaveId",e.deleteLeaveObj).success(function(){t.get("http://localhost:4567/getEmployeeAppliedLeaveDetailsById/"+a).success(function(t){t?(e.boolDisplay=!1,e.leaveEmployeeDetails=t):(e.boolDisplay=!0,e.leaveEmployeeDetails={})})})}}]),myApp.controller("RegisterLeave",["$rootScope","$scope","$http","$window",function(e,t,a,o){var l=o.empid;t.leaveType=[{key:0,label:"Sick Leave"},{key:1,label:"Casual Leave"},{key:3,label:"Vacations"}],t.newdate={},a.get("http://localhost:4567/getEmployeeByIdForApplyingNewLeave/"+l).success(function(e){t.newEmployee=e}),t.cancelLeave=function(){o.location.href="leaveManagement.html"},t.submitLeave=function(){moment(t.newEmployee.fromDate,"DD-MM-YYYY").isValid()||(t.newdate.fromDate=moment(t.newEmployee.fromDate).format("DD-MM-YYYY"),t.newEmployee.fromDate=t.newdate.fromDate),moment(t.newEmployee.toDate,"DD-MM-YYYY").isValid()||(t.newdate.toDate=moment(t.newEmployee.toDate).format("DD-MM-YYYY"),t.newEmployee.toDate=t.newdate.toDate),a.post("http://localhost:4567/applyForNewLeave",t.newEmployee).success(function(e){"1 rows affected"==e&&(o.location.href="leaveManagement.html")})}}]),myApp.controller("UpdateLeave",["$rootScope","$scope","$http","$window",function(e,t,a,o){var l=o.empid,i=o.Uid;t.leaveType=[{key:0,label:"Sick Leave"},{key:1,label:"Casual Leave"},{key:3,label:"Vacations"}],t.newdate={},a.get("http://localhost:4567/getEmployeeAppliedLeaveDetailsById/"+l).success(function(e){t.updateLeaveEmployeeDetails=_.findWhere(e,{uniqueId:parseInt(i)})}),t.submitUpdatedLeave=function(){moment(t.updateLeaveEmployeeDetails.fromDate,"DD-MM-YYYY").isValid()||(t.newdate.fromDate=moment(t.updateLeaveEmployeeDetails.fromDate).format("DD-MM-YYYY"),t.updateLeaveEmployeeDetails.fromDate=t.newdate.fromDate),moment(t.updateLeaveEmployeeDetails.toDate,"DD-MM-YYYY").isValid()||(t.newdate.toDate=moment(t.updateLeaveEmployeeDetails.toDate).format("DD-MM-YYYY"),t.updateLeaveEmployeeDetails.toDate=t.newdate.toDate),a.post("http://localhost:4567/updateEmployeeAppliedLeaveDetailsByLeaveId",t.updateLeaveEmployeeDetails).success(function(e){"1 Rows Affected"==e&&(o.location.href="leaveManagement.html")})}}]),myApp.controller("HolidayList",["$scope","$http","$window",function(e,t){e.holidayList={},t.get("http://localhost:4567/getHolidayList").success(function(t){e.holidayList=t})}]);