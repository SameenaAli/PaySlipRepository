<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<title>Payslip Management</title>
	
	<style>
#loaderDiv{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1100;background-color:white;opacity:.6}
.ajax-loader{position:absolute;left:50%;top:50%;margin-left:-32px;margin-top:-32px;display:block;width:30;height:30;}
*{padding:0;margin:0;outline:0}
body{background:#f9ebae;font-family:Verdana,sans-serif;font-size:11px;line-height:14px;color:#5e5e5e}
select,input{height:30px;line-height:30px}
select{padding:4px}
input,textarea,select{font-family:Verdana,sans-serif;font-size:13px}
textarea{overflow:hidden}
a img{border:0}
a{color:#ba4c32;text-decoration:underline;cursor:pointer}
a:hover{color:#8d341f;text-decoration:none}
.left,.alignleft{float:left;display:inline}
.right,.alignright{float:right;display:inline}
.cl{display:block;margin-top:20px}
h1{font-size:22px;line-height:24px;color:#fff;font-weight:normal}
h1 a{color:#fff;text-decoration:none}
h2{font-size:15px;font-weight:normal}
h3{font-size:12px;line-height:14px;font-weight:normal}
h3 a{text-decoration:none}
.shell{width:988px;margin:0 auto}
#header{height:89px;background:url(images/header.gif);white-space:nowrap}
#header h1{float:left;display:inline;padding-top:12px}
#top-navigation{float:right;white-space:nowrap;color:#fff;padding-top:15px}
#top-navigation a{color:#fff}
#top-navigation span{color:#dca598}
#top{height:53px}
#navigation{height:36px}
#navigation ul{list-style-type:none}
#navigation ul li{float:left;display:inline;margin-right:2px}
#navigation ul li a,#navigation ul li a span{float:left;height:36px;background:url(images/tab.gif) no-repeat 0 0;padding:0 0 0 15px}
#navigation ul li a span{background-position:right 0;padding:0 15px 0 0}
#navigation ul li a{line-height:36px;color:#907525;text-decoration:none}
#navigation ul li a.active,#navigation ul li a:hover{background-position:0 bottom}
#navigation ul li a.active span,#navigation ul li a:hover span{background-position:right bottom}
#navigation ul li a.active{font-size:12px;font-weight:bold;color:#887e42}
.wrapper{text-align:center}
#container{padding:20px 0}
.container{margin-top:10px}
.form-group{display:inline-block}
#content{float:left;width:100%}
.table th{background:#fffdfa url(images/th.gif) repeat-x 0 0;color:#818181;text-align:left;padding:7px 10px;border-bottom:solid 1px #d2d1cb}
.table td{background:#fbfcfc;border-bottom:solid 1px #e0e0e0;padding:8px 10px}
.table tr.odd td{background:#f8f8f8}
.table tr:hover td{background:#fff9e1}
.box{background:#fbfcfc;height:100%;padding:1px;margin-bottom:-20px;margin-top:-65px}
.box-head{background:#ba4c32;height:32px;color:#fff;padding:0 10px;line-height:32px;white-space:nowrap;border-bottom:solid 1px #fff}
.box-head .right{padding-top:5px;line-height:13px}
.box-head .right label,.box-head .right input{float:left}
.box-head .right label{padding:4px 0 0 0}
.box-head .right input{margin-left:5px}
#footer{height:44px;background:url(images/footer.gif);line-height:44px;color:#fff}
#footer a{color:#fff}
.box{-moz-border-radius:5px;-webkit-border-radius:5px;-moz-box-shadow:0 0 6px #978f6c;-webkit-box-shadow:0 0 6px #978f6c}
.box-head{-moz-border-radius-topleft:5px;-moz-border-radius-topright:5px;-webkit-border-top-left-radius:5px;-webkit-border-top-right-radius:5px}
.msg p{-moz-border-radius:6px;-webkit-border-radius:6px}
caption{-moz-border-bottom-colors:none;-moz-border-left-colors:none;-moz-border-right-colors:none;-moz-border-top-colors:none;background-attachment:scroll;background-clip:border-box;background-color:#eee;background:#fffdfa url(images/th.gif) repeat-x 0 0;background-origin:padding-box;background-position:0 0;background-repeat:repeat;background-size:auto auto;border-bottom-color:#ddd;border-bottom-style:solid;border-bottom-width:1px;border-image-outset:0;border-image-repeat:stretch stretch;border-image-slice:100% 100% 100% 100%;border-image-source:none;border-image-width:1 1 1 1;border-left-color-ltr-source:physical;border-left-color-rtl-source:physical;border-left-color-value:#ddd;border-left-style-ltr-source:physical;border-left-style-rtl-source:physical;border-left-style-value:solid;border-left-width-ltr-source:physical;border-left-width-rtl-source:physical;border-left-width-value:1px;border-right-color-ltr-source:physical;border-right-color-rtl-source:physical;border-right-color-value:#ddd;border-right-style-ltr-source:physical;border-right-style-rtl-source:physical;border-right-style-value:solid;border-right-width-ltr-source:physical;border-right-width-rtl-source:physical;border-right-width-value:1px;border-top-color:#ddd;border-top-style:solid;border-top-width:1px;font-size:1.3em;font-weight:bold;margin-bottom:0;margin-left:0;margin-right:0;margin-top:0;padding-bottom:10px;padding-left:10px;padding-right:10px;padding-top:10px}

</style>
</head>

<body ng-app="myApp">
<!-- Header -->
<div id="header" >
	<div class="shell">
		<!-- Logo + Top Nav -->
		<div id="top">
			<h1><a href="http://www.nthdimenzion.com/" target="_blank"><img src="imgs/logo.png" style="width:190px;height:40px;"></a></h1>
			<div id="top-navigation">
				
			</div>
		</div>
		
		<!-- End Logo + Top Nav -->
		
		<!-- Main Nav -->
		<div id="navigation">
			<ul>
				<li><a href="index.html" class="active"><span>Generate Payslip</span></a></li>
			    <li><a href="employeeDetails.html"><span>View Employees</span></a></li>
			    <li><a href="newEmployee.html"><span>Add New Employee</span></a></li>
				<li><a href="leaveManagement.html"><span>Leave Management</span></a></li>
			   <li><a href="holidayList.html"><span>Holiday List</span></a></li>
			   

			</ul>
		</div>
		<!-- End Main Nav -->
	</div>
</div>
<!-- End Header -->

<!-- Container -->
<div id="container" ng-controller="FormCtrl">
<div id="loaderDiv" loader ><img src="imgs/ajax-loader.gif" class="ajax-loader"/>
</div>
	<div class="shell">
	<br />
		<!-- Main -->
		<div id="main">
			<div class="cl">&nbsp;</div>
			
			<!-- Content -->
			<div id="content">
			<form novalidate name="paySlipForm">	
				<!-- Box -->
				<div class="box">
					<!-- Box Head -->
					<div class="box-head">
						<h2 class="left">Generate Payslip</h2>
						
					</div>
					<!-- End Box Head -->	

					<!-- Table -->
					<div class="table" >
					<div class="container">
	
    <form class="form-inline" role="form" style="margin-bottom:20px;">
        <div class="form-group">
            <div style="float:left;margin: 6px;width: 150px;text-align: right;font-weight:bold;font-size:15px;">
                <label>Employee <span style="color:red;">*</span></label>
            </div>
			<select id="empName" ng-model="employeeDetails.selectedEmpId" ng-required="true" ng-options="employee.empNo as employee.firstName for employee in employeeDetails"ng-change="getEmployeeId(employeeDetails.selectedEmpId)" style="overflow: auto;width: 150px;">
                    <option value="">Select Employee</option>
                   </select>
				
            
        </div>
		<div class="form-group">
           <div style="float:left;margin:6px;width: 150px;text-align: right;font-weight:bold;font-size:15px;">
                <label>Year </label>
            </div>
				<select  ng-model="employeeData.year" ng-required="true"  ng-options="year.label as year.label for year in yearList" ng-change="changeMonthList()">
                <option value="">Select Year</option>
                </select>
		</div>
        <div class="form-group">
           <div style="float:left;margin: 6px;width: 150px;text-align: right;font-weight:bold;font-size:15px;">
                <label>Month </label>
            </div>
				<select  ng-model="employeeData.month" ng-required="true" ng-options="month.label as month.label for month in monthList" ng-disabled="!employeeData.year" ng-change="updateTotalNoOfDays(employeeData.year,employeeData.month)">
                <option value="">Select Month</option>
                </select>
				         
        </div>
		
	</form>
	<form class="form-inline" role="form" style="margin-top:20px;">
	<div class="form-group">
           <div style="float:left;margin:6px;width: 150px;text-align: right;font-weight:bold;font-size:15px;">
                <label ng-model="employeeData.totalNoOfDays">Total Days :{{employeeData.totalNoOfDays}}</label>
            </div>
	 </div>
		<div class="form-group">
           <div style="float:left;margin:6px;width: 180px;text-align: right;font-weight:bold;font-size:15px;">
                <label ng-model="employeeData.lopdays">LOP Days*********Samina_ALi********** : {{employeeData.lopDays}}</label>
            </div>
		</div>
		
		<div style="float:right;margin:10px;">
				<span style="color:red;">*</span><span>indicates a required field</span>
				</div>
		</form>
</div>    
		<table style="margin-top:10px;margin-bottom:20px;border-top:1px solid #CCCCCC;"width="100%" border="0" cellspacing="0" cellpadding="0" ng-show="showtable">
		<caption>Employee Details</caption>
						
							<tr>
								<th style="font-size:12px;background-image:none">Employee Name :</th>
								<td><b>{{employeeData.firstName}} {{employeeData.lastName}}</b></td><th style="font-size:12px;background-image:none">Bank Account Number :</th>
								<td><b>{{employeeData.bankAccountNo}}</b></td></tr>
							<tr><th style="font-size:12px;background-image:none">Employee ID :</th>
								<td><b>{{employeeData.empNo}}</b></td><th style="font-size:12px;background-image:none">Bank Name :</th>
								<td><b>{{employeeData.bankName}}</b></td></tr>
							<tr><th style="font-size:12px;background-image:none">PAN No. :</th>
								<td><b>{{employeeData.panNo}}</b></td><th style="font-size:12px;background-image:none">Joining Date :</th>
								<td><b>{{employeeData.joiningDate}}</b></td></tr>
							<tr><th style="font-size:12px;background-image:none">PF No. :</th>
								<td><b>{{employeeData.pfNumber}}</b></td><th style="font-size:12px;background-image:none">Designation :</th>		
								<td><b>{{employeeData.designation}}</b></td></tr>
							</table>
				
					</div>
					<!-- Table -->
					<div style="margin-top:20px;">
					<form id="resetForm">
						<table class="table" style="display:inline-block;width:48.%;border:1px solid #CCCCCC;" border="0" cellspacing="0" cellpadding="0">
						<thead ><tr style="border-right:1px solid #CCCCCC;"><th style="min-width:280px;text-align: right;font-size:16px;">EARNINGS IN &#x20B9;<th></tr></thead>
						<tbody style="border-top:1px solid #CCCCCC;">
						<tr><td style="font-weight:bold;font-size:14px;">Basic :</td><td><input class="txt" type="text" onclick="this.select()"  ng-model="employeeData.basic" onkeypress="return isNumberKey(event)" value="{{employeeData.basic}}"/></td></tr>
						<tr><td style="font-weight:bold;font-size:14px;">HRA :</td><td><input class="txt" type="text" onclick="this.select()" ng-model="employeeData.hra"  onkeypress="return isNumberKey(event)" value="{{employeeData.hra}}"/></td></tr>
						<tr ><td style="font-weight:bold;font-size:14px;">Medical :</td><td ng-model="employeeData.medical" >{{employeeData.medical}}<!--<input class="txt" type="text"  ng-model="employeeData.medical" value="{{employeeData.medical}}"/>--></td></tr>
						<tr><td style="font-weight:bold;font-size:14px;">Conveyance :</td><td ng-model="employeeData.conveyence" >{{employeeData.conveyence}}<!--<input class="txt" type="text" ng-model="employeeData.conveyence"  value="{{employeeData.conveyence}}"/>--></td></tr>
						<tr><td style="font-weight:bold;font-size:14px;">Exgratia :</td><td><input class="txt" type="text" onclick="this.select()" ng-model="employeeData.exgratia" onkeypress="return isNumberKey(event)" value="{{employeeData.exgratia}}"/></td></tr>
						<tr><td style="font-weight:bold;font-size:14px;">LTA :</td><td><input class="txt" type="text" onclick="this.select()" ng-model="employeeData.lta" onkeypress="return isNumberKey(event)" value="{{employeeData.lta}}"/></td></tr>
						<tr><td style="font-weight:bold;font-size:14px;">Performance Bonus :</td><td><input class="txt" type="text" onclick="this.select()" ng-model="employeeData.performanceBonus" onkeypress="return isNumberKey(event)" value="{{employeeData.performanceBonus}}"/></td></tr>
						<tr><td style="font-weight:bold;font-size:14px;">Other Allowances :</td><td><input class="txt" type="text" onclick="this.select()" ng-model="employeeData.otherAllowance" onkeypress="return isNumberKey(event)" value="{{employeeData.otherAllowance}}"/></td></tr>
						<tr ng-model="employeeData.grossEarnings" class="summation"><td style="font-weight:bold;font-size:14px;">Gross Earnings :</td><td ng-model="employeeData.grossEarnings"><span   id="sum"></span></td></tr>
						</tbody>
						</table>
						
					<table class="table" style=" display:inline-block;border:1px solid #CCCCCC;float:right;width:49%;" border="0" cellspacing="0" cellpadding="0">
						<thead><tr><th style="min-width:280px;text-align: right;font-size:16px;">DEDUCTIONS IN &#x20B9;<th></tr></thead>
						<tbody style="border-top:1px solid #CCCCCC;">
						<tr><td style="font-weight:bold;font-size:14px;">PF Employee Contribution:</td><td ng-model="employeeData.pfEmployee">{{employeeData.pfEmployee}}<!--<input class="numericData" type="text" ng-model="employeeData.pfe" />--></td></tr>
						<tr><td style="font-weight:bold;font-size:14px;">Professional Tax:</td><td ng-model="employeeData.professionalTax" >{{employeeData.professionalTax}}<!--<input class="numericData" type="text" ng-model="employeeData.ptax" value="{{employeeData.ptax}}"/>--></td></tr>
						<tr><td style="font-weight:bold;font-size:14px;">ESI:</td><td ><input class="numericData" type="text" onclick="this.select()" ng-model="employeeData.esi" value="{{employeeData.esi}}" onkeypress="return isNumberKey(event)"/></td></tr>
						<tr><td style="font-weight:bold;font-size:14px;">TDS:</td><td ><input class="numericData" type="text" onclick="this.select()" ng-model="employeeData.tds" onkeypress="return isNumberKey(event)" value="{{employeeData.tds}}"/></td></tr>
						<tr><td style="font-weight:bold;font-size:14px;">Other Deductions:</td><td ><input class="numericData" type="text" onclick="this.select()" ng-model="employeeData.otherDeductions" onkeypress="return isNumberKey(event)" value="{{employeeData.otherDeductions}}"/></td></tr>
						<tr><td style="height:161px;"></td><td></td></tr>
						
						<tr id="summation" ><td style="font-weight:bold;font-size:14px;">Total Deductions:</td><td ><span ng-model="employeeData.totalDeductions" id="sums"></span></td></tr>
						<tr><td style="font-weight:bold;font-size:14px;color:red;">NET PAYABLE IN &#x20B9;:</td><td ><span  class="numericData" ng-model="employeeData.totalPayable" >{{employeeData.grossEarnings - employeeData.totalDeductions}}</span></td></tr>
						</tbody>
						</table>
						</form>
					</div>
					 <form class="form-inline" role="form" style="width: 980px;">
					<div class="form-group" >
						<div style="float:left;margin: 6px;text-align: right;font-weight:bold;font-size:15px;margin-top:20px;">
							<label>Comments :</label>
						</div>
						<TEXTAREA ROWS=6 COLS=120 ng-model="employeeData.comments" placeholder="Message" style="margin-top:20px;"></TEXTAREA>
				</div>
			</form>
			<div class="wrapper">
				<button ng-model="button"  ng-click="sendMail()" ng-disabled="(!employeeDetails.selectedEmpId)" id="sendbutton" style="font-size:16px;padding:7px 11px 7px 11px; cursor:pointer;box-shadow: 1px 1px 1px #888888; margin:20px;">Send Mail</button>
			</div>
			
				
				</div>
				<!-- End Box -->
				
</form>
			</div>
			<!-- End Content -->
			
			
			<div class="cl">&nbsp;</div>			
		</div>
		<!-- Main -->
	</div>
</div>
<!-- End Container -->

<!-- Footer -->
<div id="footer" >
	<div class="shell" >
		<span class="left">&copy; 2014 - Nthdimenzion</span>
		<span class="right">
			Design by <a href="http://www.nthdimenzion.com/" target="_blank" >Nthdimenzion.com</a>
		</span>
	</div>
</div>
<!-- End Footer -->

<script  type="text/javascript" src="js/NewFile.js" ></script>
<!--<script type="text/javascript" src="js/jquery-1.9.1.min.js"></script>
<script   data-require="angular.js@1.0.x" src="js/angular.js" data-semver="1.1.4"></script>
<script src="js/ui-bootstrap-tpls-0.5.0.js"></script>-->
    <script src="js/dist/ng-flow-standalone.js"></script>
	<script  type="text/javascript" src="js/moment.js"></script>
<!--<script  type="text/javascript" src="app.js"></script>-->
	<script  type="text/javascript" src="js/underscore-min.js"></script>
	
	<script type='text/javascript'>
	var myApp = angular.module('myApp',['ui.bootstrap','flow']);

myApp.config(['$httpProvider', function($httpProvider) {
$httpProvider.interceptors.push('httpInterceptor');
$httpProvider.defaults.headers.common = {};
$httpProvider.defaults.headers.post = {};
$httpProvider.defaults.headers.put = {};
$httpProvider.defaults.headers.patch = {};
$httpProvider.defaults.useXDomain = true;
delete $httpProvider.defaults.headers.common['X-Requested-With'];
}]);
myApp.factory('httpInterceptor', function ($q, $rootScope, $log) {

    var numLoadings = 0;

    return {
        request: function (config) {

            numLoadings++;

            // Show loader
            $rootScope.$broadcast("loader_show");
            return config || $q.when(config)

        },
        response: function (response) {

            if ((--numLoadings) === 0) {
                // Hide loader
                $rootScope.$broadcast("loader_hide");
            }

            return response || $q.when(response);

        },
        responseError: function (response) {

            if (!(--numLoadings)) {
                // Hide loader
                $rootScope.$broadcast("loader_hide");
            }

            return $q.reject(response);
        }
    };
});
myApp.config(['flowFactoryProvider', function (flowFactoryProvider) {
  flowFactoryProvider.defaults = {
    target: 'upload.php',
    permanentErrors: [404, 500, 501],
    maxChunkRetries: 1,
    chunkRetryInterval: 5000,
    simultaneousUploads: 4,
    singleFile: true
  };
  flowFactoryProvider.on('catchAll', function (event) {
    //console.log('catchAll', arguments);
  });
  }]);

myApp.directive("loader", function ($rootScope) {
    return function ($scope, element, attrs) {
        $scope.$on("loader_show", function () {
            return element.show();
        });
        return $scope.$on("loader_hide", function () {
            return element.hide();
        });
    };
});
/*myApp.config(['$routeProvider','$locationProvider', function($routeProvider,$locationProvider) {
  $routeProvider.
  when('/index', {
    templateUrl: 'index.html',
    controller: 'MainCtrl'
  }).
  when('/generatePaySlip', {
	templateUrl: 'generatePaySlip.html',
	controller: 'FormCtrl'
	}).
   when('/newEmployee', {
   templateUrl: 'newEmployee.html',   
   controller: 'AddNewEmployee'
   }).
  when('/updateOldEmployee/:id', {
  templateUrl: 'updateOldEmployee.html',
  controller: 'updateOldEmployee'
  }).
   otherwise({
   redirectTo: '/index'
   });
         $locationProvider.html5Mode(true);
}]);
*/

myApp.controller('MainCtrl',['$scope', '$http','$dialog','$location', function($scope,$http,$dialog,$location){

	$scope.id='';
	
	$http.get('http://localhost:4567/getEmployees').success(function(data){ //192.168.1.52
		$scope.employeeDetails = data;
	 	
	});
	
	var t = '<div class="modal-dialog">' +
              '<div class="modal-content">' +
                '<div class="modal-header">' +
                 '<button type="button" class="close" ng-click="close()" aria-hidden="true">&times;</button>' +
                  '<h4 class="modal-title">View Employee Details</h4>' +
                '</div>' +
                '<div class="modal-body">' +
                  '<div style="margin: 0 auto; width: 100px"> <img class="thumbnailImg" style="width:100px;height:100px;margin:10px;" src="{{viewEmployeeDetails.empImage}}"   /></div>' + '<div class="table">'+
				'<table width="100%" border="0" cellspacing="0" cellpadding="0">'+
				
				'<tr>'+
					'<th>Employee ID</th><td>{{viewEmployeeDetails.empNo}}</td>'+
					'<th>Employee Name</th><td><h3>{{viewEmployeeDetails.firstName}}  {{viewEmployeeDetails.lastName}}</h3></td>'+
					'<th>Email ID</th><td>{{viewEmployeeDetails.emailId}}</td>'+
					'<th>Alternate Email ID</th><td>{{viewEmployeeDetails.alternateEmailId}}</td>'+
					'<th>Status</th><td>{{viewEmployeeDetails.employeeStatus}}</td>'+
				'</tr>'+
				'<tr>'+	
					'<th>PAN No.</th><td>{{viewEmployeeDetails.panNo}}</td>'+
					'<th>PF No.</th><td>{{viewEmployeeDetails.pfNumber}}</td>'+
					'<th>Bank Name</th><td>{{viewEmployeeDetails.bankName}}</td>'+
					'<th>Bank Details</th><td>{{viewEmployeeDetails.bankAccountNo}}</td>'+
					'<th>Joining Date</th><td>{{viewEmployeeDetails.joiningDate}}</td>'+
				'</tr>'+
				'<tr>'+
	     				'<th>Designation</th><td>{{viewEmployeeDetails.designation}}</td>'+
						'<th>Location</th><td>{{viewEmployeeDetails.location}}</td>'+
						'<th>Date Of Birth</th><td>{{viewEmployeeDetails.dateOfBirth}}</td>'+
						'<th>Marriage Date</th><td>{{viewEmployeeDetails.marriageDate}}</td>'+
						'<th>Contact No.</th><td>{{viewEmployeeDetails.contactNumber}}</td>'+
				'</tr>'+
				'<tr>'+
						'<th>Alternate Contact No.</th><td>{{viewEmployeeDetails.alternateContactNumber}}</td>'+
						'<th>Emergengy Contact Person </th><td>{{viewEmployeeDetails.emergencyContactPerson}}</td>'+
				'</tr>'+

				'</table>'+
			'</div>'+
			'</div>' +
                '<div class="modal-footer">' +
                  '<button type="button" class="btn btn-default" ng-click="close()">Close</button>' +
                '</div>' +
              '</div><!-- /.modal-content -->' +
            '</div><!-- /.modal-dialog -->';
 
    $scope.opts = {
        backdrop: true,
        keyboard: true,
        backdropClick: true,
        template: t, // OR: 
		//templateUrl: 'viewDialogWindow.html',
        controller: 'ViewDialogController',
		resolve: {
			idParam: function(){
				return $scope.id;
			}
		}
	};

    $scope.openDialog = function (id) {
		$scope.id=id;
	    var d = $dialog.dialog($scope.opts);
		d.open().then(function (result) {
		    if (result) {
                alert('dialog closed with result: ' + result);
            }
        });
    };

}]);
myApp.controller('ViewDialogController',['$scope','$http', 'dialog','idParam',function($scope,$http,dialog,idParam) {
	$scope.viewEmployeeDetails={};
	$http.get('http://localhost:4567/getEmployees').success(function(data){
			$scope.employeeDetails =data;
			$scope.viewEmployeeDetails =_.findWhere($scope.employeeDetails,{empNo:idParam});
					//	console.log($scope.viewEmployeeDetails);
				if(!$scope.viewEmployeeDetails.empImage){
					$scope.viewEmployeeDetails.empImage="imgs/empty.png";
				}
				if($scope.viewEmployeeDetails.employeeStatus == true){
					$scope.viewEmployeeDetails.employeeStatus='Active';
				}else{
					$scope.viewEmployeeDetails.employeeStatus='Inactive';
				}
				
		});
		$scope.close = function (result) {
			dialog.close(result);
		};
}]);
myApp.controller('UpdateOldEmployee',['$rootScope','$scope','$window','$location', '$http', function($rootScope,$scope,$window,$location,$http){
		
		
		$scope.newEmployee={};
		var id = $window.empid;
		$scope.dateField={};
	$scope.updateEmployee=function(){
		//console.log($window.imageName);
		if($window.imageName){
			$scope.newEmployee.empImage=$window.imageName;
		}
		//console.log("DOB"+$scope.newEmployee.dateOfBirth);
		//console.log("DOJ"+$scope.newEmployee.joiningDate);
//console.log("DOM"+$scope.newEmployee.marriageDate);
		if (!moment($scope.newEmployee.dateOfBirth,'DD-MM-YYYY').isValid()) {
			$scope.dateField.dateOfBirth = moment($scope.newEmployee.dateOfBirth).format("DD-MM-YYYY");
			$scope.newEmployee.dateOfBirth=$scope.dateField.dateOfBirth ;
		}
		if (!moment($scope.newEmployee.joiningDate,'DD-MM-YYYY').isValid()) {
			$scope.dateField.joiningDate = moment($scope.newEmployee.joiningDate).format("DD-MM-YYYY");
			$scope.newEmployee.joiningDate=$scope.dateField.joiningDate ;
		}
		if($scope.newEmployee.marriageDate){
			if(!moment($scope.newEmployee.marriageDate,'DD-MM-YYYY').isValid()){
				$scope.dateField.dateOfMarriage = moment($scope.newEmployee.marriageDate).format("DD-MM-YYYY");
				$scope.newEmployee.marriageDate=$scope.dateField.dateOfMarriage ;
			}
		}else{
			$scope.newEmployee.marriageDate="";
		}
		//console.log($scope.newEmployee);
		$http.post('http://localhost:4567/updateEmployee', $scope.newEmployee).success(function(data){
				
		if(data=='1 rows updated'){
				alert("Record Updated ");
			}else{
				alert("Record Not Updated" );
			}
			$window.location.href = "employeeDetails.html";
				
		});
	
	}

	var id=parseInt(id);
	$http.get('http://localhost:4567/getEmployeeById/'+id).success(function(data){
		$scope.newEmployee =data;
		if($scope.newEmployee.employeeStatus == true){
			$scope.newEmployee.employeeStatus=true;
		}else{
			$scope.newEmployee.employeeStatus=false;
		}
				
	});
}]);

myApp.controller('AddNewEmployee',['$rootScope','$scope','$http','$routeParams','$route','$location','$window', function($rootScope,$scope,$http,$routeParams,$route,$location,$window){
   
	$scope.newEmployee={};
	$scope.newDateField={};
	$scope.newEmployee.employeeStatus=true;

	$scope.addNewEmployee = function(){
		$scope.newEmployee.empImage=$window.imageName;
		//console.log("DOB"+$scope.newEmployee.dateOfBirth);
		//console.log("DOJ"+$scope.newEmployee.joiningDate);
		//console.log("DOM"+$scope.newEmployee.marriageDate);
		if (!moment($scope.newEmployee.dateOfBirth,'DD-MM-YYYY').isValid()) {
			$scope.newDateField.dateOfBirth = moment($scope.newEmployee.dateOfBirth).format("DD-MM-YYYY");
			$scope.newEmployee.dateOfBirth=$scope.newDateField.dateOfBirth ;
		
		}
		if (!moment($scope.newEmployee.joiningDate,'DD-MM-YYYY').isValid()) {
			$scope.newDateField.joiningDate = moment($scope.newEmployee.joiningDate).format("DD-MM-YYYY");
			$scope.newEmployee.joiningDate=$scope.newDateField.joiningDate ;
		}
		
		if($scope.newEmployee.marriageDate){
			if(!moment($scope.newEmployee.marriageDate,'DD-MM-YYYY').isValid()){
				$scope.newDateField.dateOfMarriage = moment($scope.newEmployee.marriageDate).format("DD-MM-YYYY");
				$scope.newEmployee.marriageDate=$scope.newDateField.dateOfMarriage ;
				}
		}else{
			$scope.newEmployee.marriageDate="";
		}
		//console.log($scope.newEmployee);
		if(!$scope.newEmployee.empImage){
			$scope.newEmployee.empImage="imgs/empty.png";
			
		}
		
		$http.post('http://localhost:4567/addEmployee', $scope.newEmployee).success(function(data){	
				
			if(data=='1 rows affected'){
				alert("Record Added ");
			}else{
				alert("Record Not Added" );
			}
			//$scope.resetData();
			$window.location.reload();

		});
	
	};
	

}]);
myApp.controller('FormCtrl',['$rootScope','$scope', '$http', function($rootScope,$scope,$http){
	

	$scope.showtable  = false;
	$scope.days =[];
	var empObj;
	var boolVal = false;
	var boolDisplay=true;
	$scope.monthList =[];
	$scope.yearList =[];
	$scope.lopDays =[];
	$scope.employeeData=[];
	//For calculating 12% of Basic
	$scope.$watch('employeeData.basic * 12 / 100', function (value) {
		
		if(value){
			$scope.employeeData.pfEmployee =value;
			$scope.employeeData.totalDeductions=value + 200;
			//$scope.employeeData.grossEarnings=value + 200;
		}else{
			$scope.employeeData.pfEmployee ='';
			
		}
    });

	for(i=0;i<=31;i++){
	   $scope.days.push({key: i,label:i});
    }
	$http.get('http://localhost:4567/getEmployeesByStatus').success(function(data){ 
		$scope.employeeDetails =data;
		$scope.monthList = $scope.getMonthList();
		$scope.yearList =$scope.getYearList();
		if(boolDisplay){
			$http.get('http://localhost:4567/getCurrentYearMonthWithNoOfDays').success(function(data){ 
				 boolDisplay = false;
				$scope.employeeData.month=data.month;
				$scope.employeeData.year=data.year;
				$scope.employeeData.totalNoOfDays=data.noOfDays;
				//$scope.employeeData.lopdays='0';
			});
		}
		
	});
	
	$scope.changeMonthList=function(){
		$scope.employeeData.totalNoOfDays=0;
		$scope.employeeData.month='';
		$scope.monthList = $scope.getMonthList();
	}
	$scope.updateTotalNoOfDays=function(y,m){
			
		$http.get('http://localhost:4567/getNoOfDaysForGivenYearAndMonth/getDate?year='+y+'&month='+m).success(function(data){ 
			$scope.employeeData.month=data.month;
				$scope.employeeData.year=data.year;
				$scope.employeeData.totalNoOfDays=data.noOfDays;
				//$scope.employeeData.lopdays='0';
		});
	}
	$scope.getMonthList = function(){
		months = [];
        startOfMonth = moment().month(0).startOf("month");
        months.push({key: 0, label: startOfMonth.format('MMMM')});
        for (i = 1; i < 12; i++) {
               months.push({key: i, label: startOfMonth.add('months', 1).format('MMMM')});
            }
        return months;
	};
	$scope.getYearList = function(){
		years = [];
		startYear = moment().startOf("year");
        for (i = 1; i <= 3; i++) {
         years.push({key:i, label:startYear.format('YYYY')});
             startYear = startYear.subtract('years', 1);
         }
		return years;
	};
    $scope.getEmployeeId = function(employeeId){
		if($scope.employeeData){
			empObj = $scope.employeeData;
			//console.log(empObj);
			boolVal=true;
		 }
		$scope.employeeData =_.findWhere($scope.employeeDetails,{empNo:employeeId});
		$scope.employeeData.medical='1250';
		$scope.employeeData.conveyence='800';
		$scope.employeeData.esi='0';
		$scope.employeeData.professionalTax='200';
		$scope.employeeData.basic='0';
		$scope.employeeData.hra='0';
		$scope.employeeData.exgratia='0';
		$scope.employeeData.lta='0';
		$scope.employeeData.performanceBonus='0';
		$scope.employeeData.otherAllowance='0';
		$scope.employeeData.tds='0';
		$scope.employeeData.otherDeductions='0';
		
		

		if(boolVal){
			$scope.employeeData.month = empObj.month;
			$scope.employeeData.year = empObj.year;
			$scope.employeeData.totalNoOfDays = empObj.totalNoOfDays;
			$scope.employeeData.comments = empObj.comments;
			
		}
		
		$scope.showtable  = true;
	};
	
	$scope.sendMail = function(){
	
		
		//console.log($scope.employeeData);
		$scope.employeeData =_.findWhere($scope.employeeDetails,{empNo:$scope.employeeDetails.selectedEmpId});
		
		//console.log($scope.employeeData);
		$http.post('http://localhost:4567/submit', $scope.employeeData).success(function(data){
			$scope.resetData();
			//console.log(data);
			if(data=='Email successfully sent'){
				alert("Email is sent to " + $scope.employeeData.firstName +" "+ $scope.employeeData.lastName);
			}else{
				alert("Mail cannot be sent" );
			}
	  });
    	
		$scope.showtable = false;
		
		
	};
	$scope.resetData = function(){
		$scope.employeeData.totalDeductions='';
		$scope.employeeData.grossEarnings='';
		$scope.employeeData.totalPayable='';
		$scope.employeeDetails.selectedEmpId='';
		$scope.employeeData.medical='';
		$scope.employeeData.conveyence='';
		$scope.employeeData.esi='';
		$scope.employeeData.professionalTax='';
		$scope.employeeData.basic='';
		$scope.employeeData.hra='';
		$scope.employeeData.exgratia='';
		$scope.employeeData.lta='';
		$scope.employeeData.performanceBonus='';
		$scope.employeeData.otherAllowance='';
		$scope.employeeData.tds='';
		$scope.employeeData.otherDeductions='';
	};
	$scope.updateGrossEarning = function(grossEarning){
	
		$scope.employeeData.grossEarnings=grossEarning;
	};
	$scope.updateTotalDeduction = function(totalDeduction){
		$scope.employeeData.totalDeductions=totalDeduction;
	};
	
}]);
//**************************LeaveManagement*******************

myApp.controller('LeaveManagement',['$rootScope','$scope','$http','$dialog','$location','$window', function($rootScope,$scope,$http,$dialog,$location,$window){
	$scope.id='';
	$scope.boolMsg=false;
	$scope.boolDisplay=true;
	$scope.searchEmployee={empNo:"",firstName:"",lastName:"",fromDate:"",toDate:""};
	$scope.applyDateRange = function(sdate,edate){
			$scope.searchEmployee.fromDate=moment(sdate.trim()).format("DD-MM-YYYY");
			$scope.searchEmployee.toDate=moment(edate.trim()).format("DD-MM-YYYY");
		
	};
		$scope.submitSearch=function(){
		
			$scope.boolDisplay=false;
			
				
			//console.log($scope.searchEmployee);
			$http.get('http://localhost:4567/searchByCriteria/leaveManagement?id='+$scope.searchEmployee.empNo+'&firstName='+$scope.searchEmployee.firstName+'&lastName='+$scope.searchEmployee.lastName+'&fromDate='+$scope.searchEmployee.fromDate+'&toDate='+$scope.searchEmployee.toDate).success(function(data){
			//console.log(data);
			
					if(data=='Please Select Atleast One Search Criteria'){
					$scope.boolMsg=false;
						alert("Please Select Atleast One Search Criteria");
						$http.get('http://localhost:4567/getEmployeeLeaveDetails').success(function(data){ 
							$scope.employeeDetails =data;
					});
						
					}else if(data!='No Records Found'){
						$scope.employeeDetails=data;
						$scope.searchEmployee.empNo='';
						$scope.searchEmployee.firstName='';
						$scope.searchEmployee.lastName='';
						$scope.searchEmployee.fromDate='';
						$scope.searchEmployee.toDate='';
						$scope.boolMsg=false;
					}else{
						$scope.employeeDetails={};
						$scope.searchEmployee.empNo='';
						$scope.searchEmployee.firstName='';
						$scope.searchEmployee.lastName='';
						$scope.searchEmployee.fromDate='';
						$scope.searchEmployee.toDate='';
						$scope.boolMsg=true;
					}
		});
	
		
	
	};
	if(	$scope.boolDisplay){
		$http.get('http://localhost:4567/getEmployeeLeaveDetails').success(function(data){ 
			$scope.employeeDetails =data;
		});
	}

	var t = '<div class="modal-dialog">'+
				'<div class="modal-content">'+
					'<div style="margin:10px;">'+
						'<button type="button" class="close" ng-click="close()" aria-hidden="true">&times;</button>'+
						'<h4 class="modal-title" style="font-weight:bold;">Leave Details</h4>'+
					'</div>'+
				'<div class="modal-body" >'+
	       		 	'<div class="table">'+
						'<div >'+
							'<div class="row-form clearfix">'+
								'<div class="span3" style="font-size:15px;margin:10px;">Employee ID</div>'+
								'<div class="span3" style="margin:10px;">{{employeeDetails.empNo}}</div>'+
							'</div>'+
							'<div class="row-form clearfix">'+
								'<div class="span3" style="font-size:15px;margin:10px;">Employee Name</div>'+
								'<div class="span3" style="margin:10px;">{{employeeDetails.firstName}}  {{employeeDetails.lastName}}</div>'+
							'</div> '+
							'<div class="row-form clearfix">'+
								'<div class="span3" style="font-size:15px;margin:10px;">Email ID</div>'+
                                '<div class="span3" style="margin:10px;">{{employeeDetails.emailId}}</div>'+
							'</div>'+
							'<div ng-show="boolDisplay" >'+
								'<h2 style="display:block;left-margin:20px;color:red;">No Records Found</h2>'+
							'</div>'+

					'</div>'+
					'<table width="100%" border="0" cellspacing="0" cellpadding="0" ng-show="!boolDisplay">'+
						'<tr>'+
							'<th>From Date</th>'+
							'<th>To date</th>'+
							'<th>Availed</th>'+
							'<th>Leave Type</th>'+
							'<th></th>'+
							'<th></th>'+
						'</tr>'+
						'<tr ng-repeat="leave in leaveEmployeeDetails" >'+
							'<td>{{leave.fromDate}}</td>'+
							'<td>{{leave.toDate}}</td>'+
							'<td>{{leave.differenceBetweenFromDateToDate}}</td>'+
					        '<td>{{leave.leaveType}}</td>'+
							'<td><a ng-click="editLeave({{leave.empNo}},{{leave.uniqueId}})" id="urlPathEmployee" style="cursor: pointer;text-decoration:none;"  class="btn btn-small" title="Edit">Edit</a></td>'+
							'<td><a ng-click="deleteLeave({{leave.empNo}},{{leave.uniqueId}})" style="cursor: pointer;text-decoration:none;"  class="btn btn-small" title="Delete">Delete</a></td>'+
						'</tr>'+
					'</table>'+
				'</div>'+
			'</div>'+
      '<div class="modal-footer">'+
           '<button type="button" class="btn btn-default" ng-click="close()">Close</button>'+
       '</div>'+
   '</div>'+
'</div>';
 
 
    $scope.opts = {
        backdrop: true,
        keyboard: true,
        backdropClick: true,
        template: t, // OR: 
		//templateUrl: 'viewLeaveDialogWindow.html',
        controller: 'LeaveDialogController',
		resolve: {
			idParam: function(){
				return $scope.id;
			}
		}
	};
	
	$scope.openDialog = function (id) {
				$scope.id=id;
				var d = $dialog.dialog($scope.opts);
				d.open().then(function (result) {
					if (result) {
						alert('dialog closed with result: ' + result);
					}
				});
		};
		
		$scope.registerLeaves=function(leaveObj){
			//console.log(leaveObj);
			if(leaveObj.lop > 0){
				 var r = confirm(leaveObj.firstName+" " +leaveObj.lastName+" exceed the total leaves.");
				 if (r == true) {
						$window.location.href = "registerLeave.html?id="+leaveObj.empNo;
				}
			}else{
				$window.location.href = "registerLeave.html?id="+leaveObj.empNo;
			}
		}
}]);


myApp.controller('LeaveDialogController',['$scope','$http', 'dialog','idParam','$window',function($scope,$http,dialog,idParam,$window) {
	$scope.leaveEmployeeDetails={};
	$scope.boolDisplay=false;
	$scope.deleteLeaveObj={};
	$http.get('http://localhost:4567/getEmployeeByIdForApplyingNewLeave/'+idParam).success(function(data){//192.168.1.52
			$scope.employeeDetails =data;
		});

	$http.get('http://localhost:4567/getEmployeeAppliedLeaveDetailsById/'+idParam).success(function(data){
			if(data){
				$scope.boolDisplay=false;
				$scope.leaveEmployeeDetails=data;	
			}else{
				$scope.boolDisplay=true;
				$scope.leaveEmployeeDetails={};
			}
				
	});
	$scope.close = function (result) {
			dialog.close(result);
			$window.location.reload();
	};
	$scope.editLeave=function(id,uId){
			$window.location.href = "updateLeave.html?id="+id+"&Uid="+uId;
	}
	$scope.deleteLeave=function(id,uId){
	$scope.deleteLeaveObj={empNo:id,uniqueId:uId};
	//console.log($scope.deleteLeaveObj);
			$http.post('http://localhost:4567/deleteEmployeeAppliedLeaveDetailsByLeaveId',$scope.deleteLeaveObj).success(function(data){
					$http.get('http://localhost:4567/getEmployeeAppliedLeaveDetailsById/'+id).success(function(data){
						if(data){
							$scope.boolDisplay=false;
							$scope.leaveEmployeeDetails=data;	
						}else{
							$scope.boolDisplay=true;
							$scope.leaveEmployeeDetails={};
						}
					});
			});
	}
}]);

myApp.controller('RegisterLeave',['$rootScope','$scope','$http','$window', function($rootScope,$scope,$http,$window){
	
	var id = $window.empid;               
	$scope.leaveType=[{key:0,label:'Sick Leave'},{key:1,label:'Casual Leave'},{key:3,label:'Vacations'}];
	$scope.newdate={};
	$http.get('http://localhost:4567/getEmployeeByIdForApplyingNewLeave/'+id).success(function(data){
		$scope.newEmployee =data;
	});
	$scope.cancelLeave=function(){
		$window.location.href = "leaveManagement.html";
	
	}
	$scope.submitLeave = function(){
	if (!moment($scope.newEmployee.fromDate,'DD-MM-YYYY').isValid()) {
			$scope.newdate.fromDate = moment($scope.newEmployee.fromDate).format("DD-MM-YYYY");
			$scope.newEmployee.fromDate=$scope.newdate.fromDate;
		}
		if (!moment($scope.newEmployee.toDate,'DD-MM-YYYY').isValid()) {
			$scope.newdate.toDate = moment($scope.newEmployee.toDate).format("DD-MM-YYYY");
			$scope.newEmployee.toDate=$scope.newdate.toDate;
		}
		
		//console.log($scope.newEmployee);
		$http.post('http://localhost:4567/applyForNewLeave',$scope.newEmployee).success(function(data){
			if(data=='1 rows affected'){
				$window.location.href = "leaveManagement.html";
			}
		});
	};
}]);
myApp.controller('UpdateLeave',['$rootScope','$scope','$http','$window', function($rootScope,$scope,$http,$window){
	
	var id = $window.empid;   
	var uId = $window.Uid;	
	$scope.leaveType=[{key:0,label:'Sick Leave'},{key:1,label:'Casual Leave'},{key:3,label:'Vacations'}];
	$scope.newdate={};
		$http.get('http://localhost:4567/getEmployeeAppliedLeaveDetailsById/'+id).success(function(data){
		
			$scope.updateLeaveEmployeeDetails =_.findWhere(data,{uniqueId:parseInt(uId)});
			
		});
		
	
	$scope.submitUpdatedLeave = function(){
		if (!moment($scope.updateLeaveEmployeeDetails.fromDate,'DD-MM-YYYY').isValid()) {
			$scope.newdate.fromDate = moment($scope.updateLeaveEmployeeDetails.fromDate).format("DD-MM-YYYY");
			$scope.updateLeaveEmployeeDetails.fromDate=$scope.newdate.fromDate;
		}
		if (!moment($scope.updateLeaveEmployeeDetails.toDate,'DD-MM-YYYY').isValid()) {
			$scope.newdate.toDate = moment($scope.updateLeaveEmployeeDetails.toDate).format("DD-MM-YYYY");
			$scope.updateLeaveEmployeeDetails.toDate=$scope.newdate.toDate;
		}
		
	   //console.log($scope.updateLeaveEmployeeDetails);
		$http.post('http://localhost:4567/updateEmployeeAppliedLeaveDetailsByLeaveId',$scope.updateLeaveEmployeeDetails).success(function(data){
			if(data=='1 Rows Affected'){
				$window.location.href = "leaveManagement.html";
			}
		});
	};
}]);

//********************HOLIDAY LIST******************************/

myApp.controller('HolidayList',['$scope','$http','$window',function($scope,$http,$window) {
	
	$scope.holidayList={};
	$http.get('http://localhost:4567/getHolidayList').success(function(data){
		$scope.holidayList=data;
			
	});
	
}]);

	var PFValue;
	$(document).ready(function () {
		$("#sendbutton").click(function() {
		    $("#sum").html(0);
			$("#sums").html(0);
			$('#resetForm')[0].reset();
			$('#empName').each(function(){
				$(this).prop('selectedIndex',0);
			});
			$('#lopDays').each(function(){
				$(this).prop('selectedIndex',0);
			});
			
   		}); 
	});	
	$(document).ready(function(){
 
       
        $(".txt").each(function() {
			$(this).keyup(function(){
                calculateSum();
            });
        });
 
    });
 function isNumberKey(evt){
	
    var charCode = (evt.which) ? evt.which : evt.keyCode; //event.keyCode
	
    if (charCode > 31 && charCode !=8 && charCode !=0 && charCode !=46 && (charCode < 48 || charCode > 57 ))
        return false;
    return true;
}

    function calculateSum() {
 
        var sum = 2050;
		   $(".txt").each(function() {
			if(!isNaN(this.value) && this.value.length!=0) {
                sum += parseFloat(this.value);
            }
 
        });
      	$("#sum").each(function() {
			var element = angular.element($('#sum'));
			var controller = element.controller();
			var scope = element.scope();
			scope.employeeData.grossEarnings = sum.toFixed(2);
			PFValue=scope.employeeData.pfEmployee;
			scope.$apply(function(){
				scope.updateGrossEarning(scope.employeeData.grossEarnings);
			});
		});
		  
        $("#sum").html(sum.toFixed(2));
		
    }
	$(document).ready(function(){
 
        
        $(".numericData").each(function() {
				
            $(this).keyup(function(){
                calculateSum1();
            });
        });
 
    });
 
	function calculateSum1() {
//alert(PFValue);
        var sum1 = PFValue + 200;
        
        $(".numericData").each(function() {
 
           
            if(!isNaN(this.value) && this.value.length!=0) {
                sum1 += parseFloat(this.value);
            }
 
        });
		
		$("#sums").each(function() {
			var element = angular.element($('#sums'));
			var controller = element.controller();
			var scope = element.scope();
			scope.employeeData.totalDeductions = sum1.toFixed(2);
			scope.$apply(function(){
				scope.updateTotalDeduction(scope.employeeData.totalDeductions);
			});
		});
       
        $("#sums").html(sum1.toFixed(2));
		
    }
	
	</script>

	
</body>
</html>
