!function(e,t,i){"use strict";function s(t){if(this.support=!("undefined"==typeof File||"undefined"==typeof Blob||"undefined"==typeof FileList||!Blob.prototype.slice&&!Blob.prototype.webkitSlice&&!Blob.prototype.mozSlice),this.support){this.supportDirectory=/WebKit/.test(e.navigator.userAgent),this.files=[],this.defaults={chunkSize:1048576,forceChunkSize:!1,simultaneousUploads:3,singleFile:!1,fileParameterName:"file",progressCallbacksInterval:500,speedSmoothingFactor:.1,query:{},headers:{},withCredentials:!1,preprocess:null,method:"multipart",prioritizeFirstAndLastChunk:!1,target:"/",testChunks:!0,generateUniqueIdentifier:null,maxChunkRetries:0,chunkRetryInterval:null,permanentErrors:[404,415,500,501],onDropStopPropagation:!1},this.opts={},this.events={};var i=this;this.onDrop=function(e){i.opts.onDropStopPropagation&&e.stopPropagation(),e.preventDefault();var t=e.dataTransfer;t.items&&t.items[0]&&t.items[0].webkitGetAsEntry?i.webkitReadDataTransfer(e):i.addFiles(t.files,e)},this.preventEvent=function(e){e.preventDefault()},this.opts=s.extend({},this.defaults,t||{})}}function r(e,t){this.flowObj=e,this.file=t,this.name=t.fileName||t.name,this.size=t.size,this.relativePath=t.relativePath||t.webkitRelativePath||this.name,this.uniqueIdentifier=e.generateUniqueIdentifier(t),this.chunks=[],this.paused=!1,this.error=!1,this.averageSpeed=0,this.currentSpeed=0,this._lastProgressCallback=Date.now(),this._prevUploadedSize=0,this._prevProgress=0,this.bootstrap()}function n(e,t,i){this.flowObj=e,this.fileObj=t,this.fileObjSize=t.size,this.offset=i,this.tested=!1,this.retries=0,this.pendingRetry=!1,this.preprocessState=0,this.loaded=0,this.total=0;var s=this.flowObj.opts.chunkSize;this.startByte=this.offset*s,this.endByte=Math.min(this.fileObjSize,(this.offset+1)*s),this.xhr=null,this.fileObjSize-this.endByte<s&&!this.flowObj.opts.forceChunkSize&&(this.endByte=this.fileObjSize);var r=this;this.progressHandler=function(e){e.lengthComputable&&(r.loaded=e.loaded,r.total=e.total),r.fileObj.chunkEvent("progress")},this.testHandler=function(){var e=r.status();"success"===e?(r.tested=!0,r.fileObj.chunkEvent(e,r.message()),r.flowObj.uploadNextChunk()):r.fileObj.paused||(r.tested=!0,r.send())},this.doneHandler=function(){var e=r.status();if("success"===e||"error"===e)r.fileObj.chunkEvent(e,r.message()),r.flowObj.uploadNextChunk();else{r.fileObj.chunkEvent("retry",r.message()),r.pendingRetry=!0,r.abort(),r.retries++;var t=r.flowObj.opts.chunkRetryInterval;null!==t?setTimeout(function(){r.send()},t):r.send()}}}function o(e,t){var i=e.indexOf(t);i>-1&&e.splice(i,1)}function a(e,t){setTimeout(e.bind(t),0)}function l(e){return f(arguments,function(t){t!==e&&f(t,function(t,i){e[i]=t})}),e}function f(e,t,i){if(e){var s;if("undefined"!=typeof e.length){for(s=0;s<e.length;s++)if(t.call(i,e[s],s)===!1)return}else for(s in e)if(e.hasOwnProperty(s)&&t.call(i,e[s],s)===!1)return}}s.prototype={on:function(e,t){e=e.toLowerCase(),this.events.hasOwnProperty(e)||(this.events[e]=[]),this.events[e].push(t)},off:function(e,t){e!==i?(e=e.toLowerCase(),t!==i?this.events.hasOwnProperty(e)&&o(this.events[e],t):delete this.events[e]):this.events={}},fire:function(e,t){t=Array.prototype.slice.call(arguments),e=e.toLowerCase();var i=!1;return this.events.hasOwnProperty(e)&&f(this.events[e],function(e){i=e.apply(this,t.slice(1))===!1||i}),"catchall"!=e&&(t.unshift("catchAll"),i=this.fire.apply(this,t)===!1||i),!i},webkitReadDataTransfer:function(e){function t(e){o+=e.length,f(e,function(e){if(e.isFile){var r=e.fullPath;e.file(function(e){i(e,r)},s)}else e.isDirectory&&e.createReader().readEntries(t,s)}),r()}function i(e,t){e.relativePath=t.substring(1),a.push(e),r()}function s(e){throw e}function r(){0==--o&&n.addFiles(a,e)}var n=this,o=e.dataTransfer.items.length,a=[];f(e.dataTransfer.items,function(e){var n=e.webkitGetAsEntry();return n?void(n.isFile?i(e.getAsFile(),n.fullPath):n.createReader().readEntries(t,s)):void r()})},generateUniqueIdentifier:function(e){var t=this.opts.generateUniqueIdentifier;if("function"==typeof t)return t(e);var i=e.relativePath||e.webkitRelativePath||e.fileName||e.name;return e.size+"-"+i.replace(/[^0-9a-zA-Z_-]/gim,"")},uploadNextChunk:function(e){var t=!1;if(this.opts.prioritizeFirstAndLastChunk&&(f(this.files,function(e){return!e.paused&&e.chunks.length&&"pending"===e.chunks[0].status()&&0===e.chunks[0].preprocessState?(e.chunks[0].send(),t=!0,!1):!e.paused&&e.chunks.length>1&&"pending"===e.chunks[e.chunks.length-1].status()&&0===e.chunks[0].preprocessState?(e.chunks[e.chunks.length-1].send(),t=!0,!1):void 0}),t))return t;if(f(this.files,function(e){return e.paused||f(e.chunks,function(e){return"pending"===e.status()&&0===e.preprocessState?(e.send(),t=!0,!1):void 0}),t?!1:void 0}),t)return!0;var i=!1;return f(this.files,function(e){return e.isComplete()?void 0:(i=!0,!1)}),i||e||a(function(){this.fire("complete")},this),!1},assignBrowse:function(e,i,s,r){"undefined"==typeof e.length&&(e=[e]),f(e,function(e){var n;"INPUT"===e.tagName&&"file"===e.type?n=e:(n=t.createElement("input"),n.setAttribute("type","file"),l(n.style,{visibility:"hidden",position:"absolute"}),e.appendChild(n),e.addEventListener("click",function(){n.click()},!1)),this.opts.singleFile||s||n.setAttribute("multiple","multiple"),i&&n.setAttribute("webkitdirectory","webkitdirectory"),f(r,function(e,t){n.setAttribute(t,e)});var o=this;n.addEventListener("change",function(e){o.addFiles(e.target.files,e),e.target.value=""},!1)},this)},assignDrop:function(e){"undefined"==typeof e.length&&(e=[e]),f(e,function(e){e.addEventListener("dragover",this.preventEvent,!1),e.addEventListener("dragenter",this.preventEvent,!1),e.addEventListener("drop",this.onDrop,!1)},this)},unAssignDrop:function(e){"undefined"==typeof e.length&&(e=[e]),f(e,function(e){e.removeEventListener("dragover",this.preventEvent),e.removeEventListener("dragenter",this.preventEvent),e.removeEventListener("drop",this.onDrop)},this)},isUploading:function(){var e=!1;return f(this.files,function(t){return t.isUploading()?(e=!0,!1):void 0}),e},upload:function(){if(!this.isUploading()){this.fire("uploadStart");for(var e=!1,t=1;t<=this.opts.simultaneousUploads;t++)e=this.uploadNextChunk(!0)||e;e||a(function(){this.fire("complete")},this)}},resume:function(){f(this.files,function(e){e.resume()})},pause:function(){f(this.files,function(e){e.pause()})},cancel:function(){for(var e=this.files.length-1;e>=0;e--)this.files[e].cancel()},progress:function(){var e=0,t=0;return f(this.files,function(i){e+=i.progress()*i.size,t+=i.size}),t>0?e/t:0},addFile:function(e,t){this.addFiles([e],t)},addFiles:function(e,t){var i=[];f(e,function(e){if((e.size%4096!==0||"."!==e.name&&"."!==e.fileName)&&!this.getFromUniqueIdentifier(this.generateUniqueIdentifier(e))){var s=new r(this,e);this.fire("fileAdded",s,t)&&i.push(s)}},this),this.fire("filesAdded",i,t)&&f(i,function(e){this.opts.singleFile&&this.files.length>0&&this.removeFile(this.files[0]),this.files.push(e)},this),this.fire("filesSubmitted",i,t)},removeFile:function(e){for(var t=this.files.length-1;t>=0;t--)this.files[t]===e&&(this.files.splice(t,1),e.abort())},getFromUniqueIdentifier:function(e){var t=!1;return f(this.files,function(i){i.uniqueIdentifier===e&&(t=i)}),t},getSize:function(){var e=0;return f(this.files,function(t){e+=t.size}),e},sizeUploaded:function(){var e=0;return f(this.files,function(t){e+=t.sizeUploaded()}),e},timeRemaining:function(){var e=0,t=0;return f(this.files,function(i){i.paused||i.error||(e+=i.size-i.sizeUploaded(),t+=i.averageSpeed)}),e&&!t?Number.POSITIVE_INFINITY:e||t?Math.floor(e/t):0}},r.prototype={measureSpeed:function(){var e=Date.now()-this._lastProgressCallback;if(e){var t=this.flowObj.opts.speedSmoothingFactor,i=this.sizeUploaded();this.currentSpeed=Math.max((i-this._prevUploadedSize)/e*1e3,0),this.averageSpeed=t*this.currentSpeed+(1-t)*this.averageSpeed,this._prevUploadedSize=i}},chunkEvent:function(e,t){switch(e){case"progress":if(Date.now()-this._lastProgressCallback<this.flowObj.opts.progressCallbacksInterval)break;this.measureSpeed(),this.flowObj.fire("fileProgress",this),this.flowObj.fire("progress"),this._lastProgressCallback=Date.now();break;case"error":this.error=!0,this.abort(!0),this.flowObj.fire("fileError",this,t),this.flowObj.fire("error",t,this);break;case"success":if(this.error)return;this.measureSpeed(),this.flowObj.fire("fileProgress",this),this.flowObj.fire("progress"),this._lastProgressCallback=Date.now(),this.isComplete()&&(this.currentSpeed=0,this.averageSpeed=0,this.flowObj.fire("fileSuccess",this,t));break;case"retry":this.flowObj.fire("fileRetry",this)}},pause:function(){this.paused=!0,this.abort()},resume:function(){this.paused=!1,this.flowObj.upload()},abort:function(e){this.currentSpeed=0,this.averageSpeed=0;var t=this.chunks;e&&(this.chunks=[]),f(t,function(e){"uploading"===e.status()&&(e.abort(),this.flowObj.uploadNextChunk())},this)},cancel:function(){this.flowObj.removeFile(this)},retry:function(){this.bootstrap(),this.flowObj.upload()},bootstrap:function(){this.abort(!0),this.error=!1,this._prevProgress=0;for(var e=this.flowObj.opts.forceChunkSize?Math.ceil:Math.floor,t=Math.max(e(this.file.size/this.flowObj.opts.chunkSize),1),i=0;t>i;i++)this.chunks.push(new n(this.flowObj,this,i))},progress:function(){if(this.error)return 1;if(1===this.chunks.length)return this._prevProgress=Math.max(this._prevProgress,this.chunks[0].progress()),this._prevProgress;var e=0;f(this.chunks,function(t){e+=t.progress()*(t.endByte-t.startByte)});var t=e/this.size;return this._prevProgress=Math.max(this._prevProgress,t>.999?1:t),this._prevProgress},isUploading:function(){var e=!1;return f(this.chunks,function(t){return"uploading"===t.status()?(e=!0,!1):void 0}),e},isComplete:function(){var e=!1;return f(this.chunks,function(t){var i=t.status();return"pending"===i||"uploading"===i||1===t.preprocessState?(e=!0,!1):void 0}),!e},sizeUploaded:function(){var e=0;return f(this.chunks,function(t){e+=t.sizeUploaded()}),e},timeRemaining:function(){if(this.paused||this.error)return 0;var e=this.size-this.sizeUploaded();return e&&!this.averageSpeed?Number.POSITIVE_INFINITY:e||this.averageSpeed?Math.floor(e/this.averageSpeed):0},getType:function(){return this.file.type&&this.file.type.split("/")[1]},getExtension:function(){return this.name.substr((~-this.name.lastIndexOf(".")>>>0)+2).toLowerCase()}},n.prototype={getParams:function(){return{flowChunkNumber:this.offset+1,flowChunkSize:this.flowObj.opts.chunkSize,flowCurrentChunkSize:this.endByte-this.startByte,flowTotalSize:this.fileObjSize,flowIdentifier:this.fileObj.uniqueIdentifier,flowFilename:this.fileObj.name,flowRelativePath:this.fileObj.relativePath,flowTotalChunks:this.fileObj.chunks.length}},getTarget:function(e){var t=this.flowObj.opts.target;return t+=t.indexOf("?")<0?"?":"&",t+e.join("&")},test:function(){this.xhr=new XMLHttpRequest,this.xhr.addEventListener("load",this.testHandler,!1),this.xhr.addEventListener("error",this.testHandler,!1);var e=this.prepareXhrRequest("GET");this.xhr.send(e)},preprocessFinished:function(){this.preprocessState=2,this.send()},send:function(){var e=this.flowObj.opts.preprocess;if("function"==typeof e)switch(this.preprocessState){case 0:return this.preprocessState=1,void e(this);case 1:return;case 2:}if(this.flowObj.opts.testChunks&&!this.tested)return void this.test();this.loaded=0,this.total=0,this.pendingRetry=!1;var t=this.fileObj.file.slice?"slice":this.fileObj.file.mozSlice?"mozSlice":this.fileObj.file.webkitSlice?"webkitSlice":"slice",i=this.fileObj.file[t](this.startByte,this.endByte);this.xhr=new XMLHttpRequest,this.xhr.upload.addEventListener("progress",this.progressHandler,!1),this.xhr.addEventListener("load",this.doneHandler,!1),this.xhr.addEventListener("error",this.doneHandler,!1);var s=this.prepareXhrRequest("POST",this.flowObj.opts.method,i);this.xhr.send(s)},abort:function(){var e=this.xhr;this.xhr=null,e&&e.abort()},status:function(){return this.pendingRetry?"uploading":this.xhr?this.xhr.readyState<4?"uploading":200==this.xhr.status?"success":this.flowObj.opts.permanentErrors.indexOf(this.xhr.status)>-1||this.retries>=this.flowObj.opts.maxChunkRetries?"error":(this.abort(),"pending"):"pending"},message:function(){return this.xhr?this.xhr.responseText:""},progress:function(){if(this.pendingRetry)return 0;var e=this.status();return"success"===e||"error"===e?1:"pending"===e?0:this.total>0?this.loaded/this.total:0},sizeUploaded:function(){var e=this.endByte-this.startByte;return"success"!==this.status()&&(e=this.progress()*e),e},prepareXhrRequest:function(e,t,i){var s=this.flowObj.opts.query;"function"==typeof s&&(s=s(this.fileObj,this)),s=l(this.getParams(),s);var r=this.flowObj.opts.target,n=null;if("GET"===e||"octet"===t){var o=[];f(s,function(e,t){o.push([encodeURIComponent(t),encodeURIComponent(e)].join("="))}),r=this.getTarget(o),n=i||null}else n=new FormData,f(s,function(e,t){n.append(t,e)}),n.append(this.flowObj.opts.fileParameterName,i);return this.xhr.open(e,r,!0),this.xhr.withCredentials=this.flowObj.opts.withCredentials,f(this.flowObj.opts.headers,function(e,t){this.xhr.setRequestHeader(t,e)},this),n}},s.extend=l,s.each=f,s.FlowFile=r,s.FlowChunk=n,s.version="2.5.0","object"==typeof module&&module&&"object"==typeof module.exports?module.exports=s:(e.Flow=s,"function"==typeof define&&define.amd&&define("flow",[],function(){return s}))}(window,document),angular.module("flow.provider",[]).provider("flowFactory",function(){"use strict";this.defaults={},this.factory=function(e){return new Flow(e)},this.events=[],this.on=function(e,t){this.events.push([e,t])},this.$get=function(){var e=this.factory,t=this.defaults,i=this.events;return{create:function(s){var r=e(angular.extend({},t,s));return angular.forEach(i,function(e){r.on(e[0],e[1])}),r}}}}),angular.module("flow.init",["flow.provider"]).controller("flowCtrl",["$scope","$attrs","$parse","flowFactory",function(e,t,i,s){var r=angular.extend({},e.$eval(t.flowInit)),n=s.create(r);n.on("catchAll",function(t){var i=Array.prototype.slice.call(arguments);i.shift();var s=e.$broadcast.apply(e,["flow::"+t,n].concat(i));return{progress:1,filesSubmitted:1,fileSuccess:1,fileError:1,complete:1}[t]&&e.$apply(),s.defaultPrevented?!1:void 0}),e.$flow=n,t.hasOwnProperty("flowName")&&(i(t.flowName).assign(e,n),e.$on("$destroy",function(){i(t.flowName).assign(e)}))}]).directive("flowInit",[function(){return{scope:!0,controller:"flowCtrl"}}]),angular.module("flow.btn",["flow.init"]).directive("flowBtn",[function(){return{restrict:"EA",scope:!1,require:"^flowInit",link:function(e,t,i){var s=i.hasOwnProperty("flowDirectory"),r=i.hasOwnProperty("flowSingleFile"),n=i.hasOwnProperty("flowAttrs")&&e.$eval(i.flowAttrs);e.$flow.assignBrowse(t,s,r,n)}}}]),angular.module("flow.dragEvents",["flow.init"]).directive("flowPreventDrop",function(){return{scope:!1,link:function(e,t){t.bind("drop dragover",function(e){e.preventDefault()})}}}).directive("flowDragEnter",["$timeout",function(e){return{scope:!1,link:function(t,i,s){function r(e){var t=!1,i=e.dataTransfer||e.originalEvent.dataTransfer;return angular.forEach(i&&i.types,function(e){"Files"===e&&(t=!0)}),t}var n,o=!1;i.bind("dragover",function(i){r(i)&&(o||(t.$apply(s.flowDragEnter),o=!0),e.cancel(n),i.preventDefault())}),i.bind("dragleave drop",function(){n=e(function(){t.$eval(s.flowDragLeave),n=null,o=!1},100)})}}}]),angular.module("flow.drop",["flow.init"]).directive("flowDrop",function(){return{scope:!1,require:"^flowInit",link:function(e,t,i){function s(){e.$flow.assignDrop(t)}function r(){e.$flow.unAssignDrop(t)}i.flowDropEnabled?e.$watch(i.flowDropEnabled,function(e){e?s():r()}):s()}}}),!function(e){"use strict";function t(e){return e.charAt(0).toUpperCase()+e.slice(1)}var i=e.module("flow.events",["flow.init"]),s={fileSuccess:["$file","$message"],fileProgress:["$file"],fileAdded:["$file","$event"],filesAdded:["$files","$event"],filesSubmitted:["$files","$event"],fileRetry:["$file"],fileError:["$file","$message"],uploadStart:[],complete:[],progress:[],error:["$message","$file"]};e.forEach(s,function(s,r){var n="flow"+t(r);"flowUploadStart"==n&&(n="flowUploadStarted"),i.directive(n,[function(){return{require:"^flowInit",controller:["$scope","$attrs",function(t,i){t.$on("flow::"+r,function(){var r=Array.prototype.slice.call(arguments),o=r.shift();if(t.$flow===r.shift()){var a={};e.forEach(s,function(e,t){a[e]=r[t]}),t.$eval(i[n],a)===!1&&o.preventDefault()}})}]}}])})}(angular);var imageName;angular.module("flow.img",["flow.init"]).directive("flowImg",[function(){return{scope:!1,require:"^flowInit",link:function(e,t,i){var s=i.flowImg;e.$watch(s,function(t){if(t){var s=new FileReader;s.readAsDataURL(t.file),s.onload=function(t){e.$apply(function(){imageName=t.target.result,i.$set("src",t.target.result)})}}})}}}]),angular.module("flow.transfers",["flow.init"]).directive("flowTransfers",[function(){return{scope:!0,require:"^flowInit",link:function(e){e.transfers=e.$flow.files}}}]),angular.module("flow",["flow.provider","flow.init","flow.events","flow.btn","flow.drop","flow.transfers","flow.img","flow.dragEvents"]);